{"version":3,"sources":["../../../../units/rb-example-todo-client/relay/ToDoDeleteMutation.js"],"names":["mutation","sharedUpdater","store","user","deletedId","userProxy","get","id","forEach","status","connection","ConnectionHandler","getConnection","deleteNode","commit","environment","aToDo","variables","input","updater","payload","getRootField","getValue","optimisticUpdater","ToDo_TotalCount","setValue","ToDo_CompletedCount","ToDo_Complete"],"mappings":";;AAEA;AACA,6C,CAHA;;AAKA,MAAMA,QAAQ,8EAAd;;;;;;;;;;;;AAYA,SAASC,aAAT,CAAwBC,KAAxB,EAA+BC,IAA/B,EAAqCC,SAArC,EAAiD;AAC/C,QAAMC,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAWH,IAAI,CAACI,EAAhB,CAAlB;AACC,GAAE,KAAF,EAAS,QAAT,EAAmB,WAAnB,EAAiCC,OAAjC,CAA0CC,MAAM,IAAI;AACnD,UAAMC,UAAU,GAAGC,gCAAkBC,aAAlB,CAAiCP,SAAjC,EAA4C,gBAA5C,EAA8D,EAAEI,MAAF,EAA9D,CAAnB;AACA,QAAKC,UAAL,EAAkB;AAChBC,sCAAkBE,UAAlB,CAA8BH,UAA9B,EAA0CN,SAA1C;AACD;AACF,GALA;AAMF;;AAED,SAASU,MAAT,CAAiBC,WAAjB,EAA8BZ,IAA9B,EAAoCa,KAApC,EAA4C;AAC1C,SAAO,gCAAgBD,WAAhB,EAA6B;AAClCf,IAAAA,QADkC;AAElCiB,IAAAA,SAAS,EAAE;AACTC,MAAAA,KAAK,EAAE,EAAEX,EAAE,EAAES,KAAK,CAACT,EAAZ,EADE,EAFuB;;;AAMlCY,IAAAA,OAAO,CAAEjB,KAAF,EAAU;AACf,YAAMkB,OAAO,GAAGlB,KAAK,CAACmB,YAAN,CAAoB,YAApB,CAAhB;AACApB,MAAAA,aAAa,CAAEC,KAAF,EAASC,IAAT,EAAeiB,OAAO,CAACE,QAAR,CAAkB,WAAlB,CAAf,CAAb;AACD,KATiC;;AAWlCC,IAAAA,iBAAiB,CAAErB,KAAF,EAAU;AACzBD,MAAAA,aAAa,CAAEC,KAAF,EAASC,IAAT,EAAea,KAAK,CAACT,EAArB,CAAb;;AAEA,YAAMF,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAWH,IAAI,CAACI,EAAhB,CAAlB;AACA,YAAMiB,eAAe,GAAGnB,SAAS,CAACiB,QAAV,CAAoB,iBAApB,CAAxB;AACA,UAAKE,eAAe,IAAI,IAAxB,EAA+B;AAC7BnB,QAAAA,SAAS,CAACoB,QAAV,CAAoBD,eAAe,GAAG,CAAtC,EAAyC,iBAAzC;AACD;AACD,YAAME,mBAAmB,GAAGrB,SAAS,CAACiB,QAAV,CAAoB,qBAApB,CAA5B;AACA,UAAKI,mBAAmB,IAAI,IAA5B,EAAmC;AACjC,YAAKV,KAAK,CAACW,aAAN,IAAuB,IAA5B,EAAmC;AACjC,cAAKX,KAAK,CAACW,aAAX,EAA2B;AACzBtB,YAAAA,SAAS,CAACoB,QAAV,CAAoBC,mBAAmB,GAAG,CAA1C,EAA6C,qBAA7C;AACD;AACF,SAJD,MAIO,IAAKF,eAAe,IAAI,IAAxB,EAA+B;AACpC;AACA,cAAKA,eAAe,GAAG,CAAlB,GAAsBE,mBAA3B,EAAiD;AAC/CrB,YAAAA,SAAS,CAACoB,QAAV,CAAoBD,eAAe,GAAG,CAAtC,EAAyC,qBAAzC;AACD;AACF;AACF;AACF,KAhCiC,EAA7B,CAAP;;AAkCD,C;;AAEc,EAAEV,MAAF,E","sourcesContent":["// @flow weak\n\nimport { commitMutation, graphql } from 'react-relay'\nimport { ConnectionHandler } from 'relay-runtime'\n\nconst mutation = graphql`\n  mutation ToDoDeleteMutation($input: ToDoDeleteInput!) {\n    ToDoDelete(input: $input) {\n      Viewer {\n        ToDo_TotalCount\n        ToDo_CompletedCount\n      }\n      deletedId\n    }\n  }\n`\n\nfunction sharedUpdater( store, user, deletedId ) {\n  const userProxy = store.get( user.id )\n  ;[ 'any', 'active', 'completed' ].forEach( status => {\n    const connection = ConnectionHandler.getConnection( userProxy, 'ToDoList_ToDos', { status })\n    if ( connection ) {\n      ConnectionHandler.deleteNode( connection, deletedId )\n    }\n  })\n}\n\nfunction commit( environment, user, aToDo ) {\n  return commitMutation( environment, {\n    mutation,\n    variables: {\n      input: { id: aToDo.id },\n    },\n\n    updater( store ) {\n      const payload = store.getRootField( 'ToDoDelete' )\n      sharedUpdater( store, user, payload.getValue( 'deletedId' ) )\n    },\n\n    optimisticUpdater( store ) {\n      sharedUpdater( store, user, aToDo.id )\n\n      const userProxy = store.get( user.id )\n      const ToDo_TotalCount = userProxy.getValue( 'ToDo_TotalCount' )\n      if ( ToDo_TotalCount != null ) {\n        userProxy.setValue( ToDo_TotalCount - 1, 'ToDo_TotalCount' )\n      }\n      const ToDo_CompletedCount = userProxy.getValue( 'ToDo_CompletedCount' )\n      if ( ToDo_CompletedCount != null ) {\n        if ( aToDo.ToDo_Complete != null ) {\n          if ( aToDo.ToDo_Complete ) {\n            userProxy.setValue( ToDo_CompletedCount - 1, 'ToDo_CompletedCount' )\n          }\n        } else if ( ToDo_TotalCount != null ) {\n          // Note this is the old ToDo_TotalCount.\n          if ( ToDo_TotalCount - 1 < ToDo_CompletedCount ) {\n            userProxy.setValue( ToDo_TotalCount - 1, 'ToDo_CompletedCount' )\n          }\n        }\n      }\n    },\n  })\n}\n\nexport default { commit }\n"],"file":"ToDoDeleteMutation.js"}